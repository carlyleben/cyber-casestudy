---
title: "Cyber Case Study Part 2"
output: html_document
date: "2023-11-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
cyber_exploits <- readRDS("data/cyber_exploits_df.RDS")
```


```{r}
status_plot_data <- cyber_exploits %>% 
  group_by(vulnStatus) %>% 
  summarize(exploit_rate = mean(exploited), size = n())

ggplot(data = status_plot_data, aes(x = exploit_rate, y = vulnStatus)) +
  geom_bar(stat = "identity", fill = 7:12) +
  theme_bw() +
  labs(x = "Percentage of Vulnerabilities Exploited", y = "Vulnerability Status")
```

```{r}
cyber_exploits <- cyber_exploits %>% 
  mutate(published = as.Date(gsub("T.*", "", published)), lastModified = as.Date(gsub("T.*", "", lastModified))) %>% 
  mutate(year_pub = as.numeric(substr(published, 1, 4)), year_mod = as.numeric(substr(published, 1, 4)))
```


```{r}
pub_year_plot <- cyber_exploits %>% 
  group_by(year_pub) %>% 
  summarize(exploit_rate = mean(exploited), size = n())

mod_year_plot <- cyber_exploits %>% 
  group_by(year_mod) %>% 
  summarize(exploit_rate = mean(exploited), size = n())
```


```{r}
ggplot(pub_year_plot, aes(x = year_pub, y = exploit_rate, size = sqrt(size))) + 
  geom_point() +
  geom_smooth()

ggplot(mod_year_plot, aes(x = year_mod, y = exploit_rate, size = sqrt(size))) + 
  geom_point() +
  geom_smooth()
```


```{r}
m1 <- glm(exploited ~ published + lastModified, data = cyber_exploits)
summary(m1)

m2 <- glm(exploited ~ published, data = cyber_exploits)
summary(m2)

m3 <- glm(exploited ~ lastModified, data = cyber_exploits)
summary(m3)

m4 <- glm(exploited ~ published + lastModified + vulnStatus, data = cyber_exploits)
summary(m4)

m5 <- glm(exploited ~ vulnStatus, data = cyber_exploits)
summary(m5)
```

```{r}
cyber_exploits
```


```{r}
cyber_exploits <- cyber_exploits %>% 
  mutate(primary_secondary = case_when(is.na(Primary.value) & is.na(Secondary.value) ~ "Neither",
                                       !is.na(Primary.value) & is.na(Secondary.value) ~ "Primary",
                                       is.na(Primary.value) & !is.na(Secondary.value) ~ "Secondary",
                                       T ~ "Both"))

primary_secondary_plot_data <- cyber_exploits %>% 
  group_by(primary_secondary) %>% 
  summarize(exploit_rate = mean(exploited), size = n())
```


```{r}
ggplot(primary_secondary_plot_data, aes(x = exploit_rate, y = primary_secondary)) +
  geom_bar(stat = "identity", fill = 5:8) +
  theme_bw() +
  labs(x = "Percentage Exploited", y = "Primary or Secondary Form")
```

Here are the analyses that I would do, roughly in order of most important to least important

Visualization and modelling of the exploitability scores and impact scores. Before you do so, you will need to figure out why some of the rows have 2 values for each of these. Once you do that you could visualize the probability of a vulnerability being exploited against each of these scores and do a logistic model
```{r}
unique(cyber_exploits$metricv31.exploitabilityScore)[1:20]
unique(cyber_exploits$metricv31.impactScore)[1:20]
```


Analysis of the Vendor organization. Some of the groups have a vendor organization, the most common one is RedHat which is an open source software company that I think does a lot of cybersecurity stuff but not positive. Here is a table of all of the organizations that are present
```{r}
cyber_exploits <- cyber_exploits %>% 
  unnest(cols = vendorComments, names_sep = ".", keep_empty = T)

sort(table(cyber_exploits$vendorComments.organization), decreasing = T)

```

The last idea I have is to do some kind of analysis on the email addresses of the source identifier. By the domain name you can see who the source of the vulnerability is and doing some kind of categorization of these could be interesting but there are so many which might make it hard.

```{r}
head(sort(table(cyber_exploits$sourceIdentifier), decreasing = T), 10)
```


I don't see too much value in analyzing any of the other columns, they are mostly just comments that you can't do much with but you're welcome to look for yourself too.